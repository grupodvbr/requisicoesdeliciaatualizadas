<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Requisi√ß√µes - DEL√çCIA GOURMET</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --primary: #2563eb;
      --danger: #dc2626;
      --bg: #f3f4f6;
      --surface: #fff;
      --text: #111827;
      --muted: #6b7280;
      --radius: 10px;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      max-width: 600px;
      width: 100%;
      padding: 25px;
      position: relative;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary);
    }
    label {
      display: block;
      margin: 12px 0 5px;
      font-weight: 600;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 15px;
      margin-bottom: 10px;
      outline: none;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(37,99,235,0.2);
    }
    .unidades {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px 0;
    }
    .unidades button {
      flex: 1 1 30%;
      padding: 8px;
      font-size: 14px;
      border: 1px solid var(--primary);
      background: #fff;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .unidades button:hover { background: rgba(37,99,235,0.1); }
    .unidades button.ativo { background: var(--primary); color: #fff; }
    textarea { resize: vertical; min-height: 60px; }

    button {
      width: 100%;
      padding: 12px;
      margin: 6px 0;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }
    .btn-blue { background: var(--primary); color: #fff; }
    .btn-blue:hover { background: #1e40af; }
    .btn-red { background: var(--danger); color: #fff; }
    .btn-red:hover { background: #991b1b; }

    #msg { text-align: center; margin-top: 10px; font-weight: bold; }

    #spinner {
      display: none;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      border: 6px solid #e5e7eb;
      border-top: 6px solid var(--primary);
      border-radius: 50%;
      width: 60px; height: 60px;
      animation: spin 1s linear infinite;
      z-index: 100;
    }
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* Hist√≥rico em cards */
    #historico {
      display: grid;
      gap: 10px;
      margin-top: 15px;
    }
    .card-item {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: var(--radius);
      padding: 10px;
      box-shadow: var(--shadow);
      font-size: 14px;
    }
    .card-item strong { color: var(--primary); }
    .status { font-weight: bold; }
    .status.enviado { color: green; }
    .status.processando { color: orange; }
  </style>
</head>
<body>
<div class="container">
  <h2>üìã Requisi√ß√£o de Compras</h2>

  <label>Solicitante:</label>
  <select id="solicitante">
    <option value="">Selecione</option>
    <option>ADM</option>
    <option>Ruan</option>
    <option>Renata</option>
    <option>Lu</option>
    <option>Bruna</option>
    <option>Renan</option>
    <option>Raimundo</option>
    <option>Cleide</option>
    <option>Ricardo</option>
    <option>Larissa</option>
    <option>Gabriel</option>
    <option>Valcir</option>
    <option>Tailson</option>
    <option>Dheure</option>
    <option>Dorilson</option>
    <option>Joane</option>
    <option>Neval</option>
    <option>Agnaldo</option>
    <option>Jenison</option>
    <option>Vania</option>
    <option>Adriana</option>
    <option>Helena</option>
    <option>Ivaneide</option>
    <option>Eunice</option>
    <option>Flayane</option>
    <option>Quiteria</option>
    <option>Luzi√¢nia</option>
    <option>Rosemeire</option>
    <option>Wilma</option>
    <option>Islane</option>
    <option>Marcelo</option>
    <option>Juciara</option>
    <option>Aline Santos</option>
    <option>Aline Rodrigues</option>
    <option>Geane</option>
  </select>

  <label>Setor:</label>
  <select id="setor">
    <option value="">Selecione</option>
    <option>Cozinha</option>
    <option>Limpeza</option>
    <option>Sushi</option>
    <option>Gar√ßons</option>
    <option>Ger√™ncia</option>
    <option>Pizzaria</option>
    <option>Bar</option>
    <option>Caixa</option>
  </select>

  <label>Produto:</label>
  <input type="text" id="item" placeholder="Digite o produto">

  <label>Quantidade:</label>
  <input type="number" id="quantidade" min="1">

  <label>Unidade de Medida:</label>
  <div class="unidades">
    <button type="button" onclick="selecionarUnidade(this,'UN.')">UN.</button>
    <button type="button" onclick="selecionarUnidade(this,'PC.')">PC.</button>
    <button type="button" onclick="selecionarUnidade(this,'L.')">L.</button>
    <button type="button" onclick="selecionarUnidade(this,'KG.')">KG.</button>
    <button type="button" onclick="selecionarUnidade(this,'CX.')">CX.</button>
  </div>

  <label>Observa√ß√µes:</label>
  <textarea id="observacoes" placeholder="Observa√ß√µes gerais"></textarea>

  <div id="spinner"></div>
  <button id="btn-enviar" class="btn-blue" onclick="enviarItem()">ENVIAR ITEM</button>
  <button class="btn-red" onclick="limparTabela()">LIMPAR HIST√ìRICO</button>
  <p id="msg"></p>

  <h3>Itens enviados nesta sess√£o:</h3>
  <div id="historico"></div>
</div>

<script>
  const solicitanteSenhas = {
    "ADM": "00", "Ruan": "Ruan10", "Renata": "Renata12","Flayane": "Flayane5","Eunice": "1097","Helena": "5556",
    "Lu": "Lu26", "Bruna": "Bruna48", "Renan": "Renan78","Raimundo": "Raimundo47",
    "Cleide": "Cleide98","Ricardo": "Ricardo41","Larissa": "Larissa56","Valcir": "Valcir24",
    "Tailson": "Tailson97","Dheure": "Dheure73","Neval": "Neval34","Agnaldo": "Agnaldo67",
    "Jenison": "Genison35","Dorilson": "Dorilson8","Joane": "joane6","Vania": "Vanial86",
    "Adriana": "Adriana49","Ivaneide": "Ivaneide46","Geane": "Geane83","Luzi√¢nia": "Luzi√¢nia8",
    "Rosemeire": "Rosemeire30","Wilma": "Wilma87","Gabriel": "Gabriel5","Islane": "Islane78",
    "Marcelo": "Marcelo75","Juciara": "Juciara35","Aline Santos": "Aline32","Aline Rodrigues": "Aline59",
    "Quiteria": "Quiteria43"
  };

  let unidadeSelecionada = '';
  let enviados = JSON.parse(localStorage.getItem('enviados')) || [];
  let senhaAutenticada = '';

  function selecionarUnidade(btn, valor) {
    unidadeSelecionada = valor;
    document.querySelectorAll('.unidades button').forEach(b => b.classList.remove('ativo'));
    btn.classList.add('ativo');
  }

  document.getElementById('solicitante').addEventListener('change', () => {
    const s = document.getElementById('solicitante').value;
    if (s) {
      const senha = prompt(`Digite a senha para ${s}:`);
      if (senha === solicitanteSenhas[s]) {
        senhaAutenticada = senha;
        document.getElementById('msg').innerText = "‚úÖ Autenticado!";
      } else {
        senhaAutenticada = '';
        document.getElementById('msg').innerText = "‚ùå Senha incorreta!";
        document.getElementById('solicitante').value = '';
      }
    }
  });

  function enviarItem() {
    const solicitante = document.getElementById('solicitante').value.trim();
    const setor = document.getElementById('setor').value.trim();
    const item = document.getElementById('item').value.trim();
    const quantidade = document.getElementById('quantidade').value.trim();
    const observacoes = document.getElementById('observacoes').value.trim();
    const horaEnvio = new Date().toLocaleTimeString();

    if (!solicitante || !setor || !item || !quantidade || !unidadeSelecionada || !senhaAutenticada) {
      document.getElementById('msg').innerText = "‚ö†Ô∏è Preencha todos os campos!";
      return;
    }

    document.getElementById('spinner').style.display = 'block';
    document.getElementById('btn-enviar').disabled = true;

    enviados.push({ item, unidade: unidadeSelecionada, quantidade, setor, hora: horaEnvio, status: "Processando" });
    save();
    atualizarTabela();

    const data = new URLSearchParams();
    data.append('Item', item);
    data.append('Unidade', unidadeSelecionada);
    data.append('Quantidade', quantidade);
    data.append('Setor', setor);
    data.append('Solicitante', solicitante);
    data.append('Observacoes', observacoes);

    fetch('https://script.google.com/macros/s/AKfycby8K9Z8pmysdQZWnFIbBEjpDL3QvzNLRCy1jp33MKY7c5a_yvtIhtCudL-CrCpwRfhxwA/exec', {
      method: 'POST',
      body: data
    })
    .then(() => {
      enviados[enviados.length - 1].status = "Enviado";
      save();
      atualizarTabela();
      alert("‚úÖ Item enviado com sucesso!");
      limparCampos();
    })
    .catch(() => {
      document.getElementById('msg').innerText = "‚ö†Ô∏è Erro ao enviar!";
    })
    .finally(() => {
      document.getElementById('spinner').style.display = 'none';
      document.getElementById('btn-enviar').disabled = false;
    });
  }

  function limparCampos() {
    document.getElementById('item').value = '';
    document.getElementById('quantidade').value = '';
    document.getElementById('observacoes').value = '';
    unidadeSelecionada = '';
    document.querySelectorAll('.unidades button').forEach(b => b.classList.remove('ativo'));
  }

  function atualizarTabela() {
    const historico = document.getElementById('historico');
    historico.innerHTML = '';
    enviados.forEach(i => {
      const card = document.createElement('div');
      card.className = 'card-item';
      card.innerHTML = `
        <div><strong>Produto:</strong> ${i.item}</div>
        <div><strong>Qtd:</strong> ${i.quantidade} ${i.unidade}</div>
        <div><strong>Setor:</strong> ${i.setor}</div>
        <div><strong>Hora:</strong> ${i.hora}</div>
        <div class="status ${i.status.toLowerCase()}"><strong>Status:</strong> ${i.status}</div>
      `;
      historico.appendChild(card);
    });
  }

  function save() {
    localStorage.setItem('enviados', JSON.stringify(enviados));
  }

  function limparTabela() {
    enviados = [];
    save();
    atualizarTabela();
  }

  function atualizarStatusPlanilha() {
    fetch('https://script.google.com/macros/s/AKfycbxk5CVDcrdUj546keN0l7p5EKNvSATgQaOuW5D4PdxmN2CESNFrLABOWCMrattDYl1qjQ/exec')
      .then(r => r.json())
      .then(data => {
        enviados.forEach(localItem => {
          const encontrado = data.find(r => r.Item === localItem.item);
          if (encontrado) localItem.status = encontrado.Status || localItem.status;
        });
        save();
        atualizarTabela();
      });
  }

  setInterval(atualizarStatusPlanilha, 10000);
  atualizarTabela();
</script>
</body>
</html>
