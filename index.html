<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Requisi√ß√£o de Compras - DEL√çCIA GOURMET</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; display: flex; justify-content: center; padding: 30px; }
    .container { background: #fff; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); max-width: 500px; width: 100%; padding: 25px; position: relative; }
    h2 { text-align: center; color: #333; margin-bottom: 20px; }
    label { display: block; margin: 12px 0 5px; font-weight: bold; }
    input, select, textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;
    }
    .unidades { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; }
    .unidades button {
      flex: 1 1 30%; padding: 8px; font-size: 14px; border: 1px solid #2196F3; background: #fff; border-radius: 20px; cursor: pointer;
    }
    .unidades button.ativo { background: #2196F3; color: #fff; }
    textarea { resize: vertical; min-height: 60px; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    button { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 16px; }
    .btn-blue { background: #2196F3; color: #fff; }
    .btn-red { background: #f44336; color: #fff; }
    #msg { text-align: center; margin-top: 10px; font-weight: bold; }
    #spinner {
      display: none; position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      border: 8px solid #f3f3f3;
      border-top: 8px solid #2196F3; border-radius: 50%;
      width: 60px; height: 60px; animation: spin 1s linear infinite; z-index: 100;
    }
    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
</head>
<body>
<div class="container">
  <h2>üìã Requisi√ß√£o de Compras DEL√çCIA GOURMET</h2>

  <label>Solicitante:</label>
  <select id="solicitante">
    <option value="">Selecione o solicitante</option>
    <option>ADM</option><option>Ruan</option><option>Renata</option>
    <option>Lu</option><option>Bruna</option><option>Renan</option>
    <option>Raimundo</option><option>Cleide</option><option>Ricardo</option>
    <option>Larissa</option><option>Gabriel</option><option>Valcir</option>
    <option>Tailson</option><option>Dheure</option><option>Dorilson</option>
    <option>Joane</option><option>Neval</option><option>Agnaldo</option>
    <option>Jenison</option><option>Vania</option><option>Adriana</option>
    <option>Helena</option><option>Ivaneide</option><option>Eunice</option>
    <option>Flayane</option><option>Quiteria</option><option>Luzi√¢nia</option>
    <option>Rosemeire</option><option>Wilma</option><option>Islane</option>
    <option>Marcelo</option><option>Juciara</option>
    <option>Aline Santos</option><option>Aline Rodrigues</option>
    <option>Geane</option>
  </select>

   <label>Setor:</label>
  <select id="setor">
    <option value="">Selecione o setor</option>
    <option>Cozinha</option>
    <option>Limpeza</option>
    <option>Sushi</option>
    <option>Gar√ßons</option>
    <option>Ger√™ncia</option>
    <option>Pizzaria</option>
    <option>Bar</option>
    <option>Caixa</option>
    <option>Churrasqueira</option>
  </select>

  <label>Produto:</label>
  <input type="text" id="item" placeholder="Digite o produto">

  <label>Quantidade:</label>
  <input type="number" id="quantidade" min="1">

  <label>Unidade de Medida:</label>
  <div class="unidades">
    <button type="button" onclick="selecionarUnidade(this, 'UN.')">UN.</button>
    <button type="button" onclick="selecionarUnidade(this, 'PC.')">PC.</button>
    <button type="button" onclick="selecionarUnidade(this, 'L.')">L.</button>
    <button type="button" onclick="selecionarUnidade(this, 'KG.')">KG.</button>
    <button type="button" onclick="selecionarUnidade(this, 'CX.')">CX.</button>
  </div>

  <label>Observa√ß√µes:</label>
  <textarea id="observacoes" placeholder="Observa√ß√µes gerais"></textarea>

  <div id="spinner"></div>
  <button id="btn-enviar" class="btn-blue" onclick="enviarItem()">ENVIAR ITEM</button>
  <button class="btn-red" onclick="limparTabela()">LIMPAR HIST√ìRICO</button>
  <p id="msg"></p>

  <h3>Itens enviados nesta sess√£o:</h3>
  <table id="historico">
    <tr><th>Produto</th><th>Unidade</th><th>Qtd</th><th>Setor</th><th>Hora</th><th>Status</th></tr>
  </table>
</div>

<script>
  const URL_GAS = "https://script.google.com/macros/s/AKfycbyXFEAq56G7oQdeCzGw_SdOnQ7XkRPMzBoS1V09Pkk_wI916FGO9nn4e9FfeNmv8KV9KA/exec";

  // üîë Senhas de cada solicitante
  const solicitanteSenhas = {
    "ADM": "00", "Ruan": "Ruan10", "Renata": "Renata12","Flayane": "Flayane5","Eunice": "1097","Helena": "5556",
    "Lu": "Lu26", "Bruna": "Bruna48", "Renan": "Renan78","Raimundo": "Raimundo47",
    "Cleide": "Cleide98","Ricardo": "Ricardo41","Larissa": "Larissa56","Valcir": "Valcir24",
    "Tailson": "Tailson97","Dheure": "Dheure73","Neval": "Neval34","Agnaldo": "Agnaldo67",
    "Jenison": "Genison35","Dorilson": "Dorilson8","Joane": "joane6","Vania": "Vanial86",
    "Adriana": "Adriana49","Ivaneide": "Ivaneide46","Geane": "Geane83","Luzi√¢nia": "Luzi√¢nia8",
    "Rosemeire": "Rosemeire30","Wilma": "Wilma87","Gabriel": "Gabriel5","Islane": "Islane78",
    "Marcelo": "Marcelo75","Juciara": "Juciara35","Aline Santos": "Aline32","Aline Rodrigues": "Aline59",
    "Quiteria": "Quiteria43"
  };

  let unidadeSelecionada = '';
  let enviados = JSON.parse(localStorage.getItem('enviados')) || [];
  let senhaAutenticada = false;

  function selecionarUnidade(btn, valor) {
    unidadeSelecionada = valor;
    document.querySelectorAll('.unidades button').forEach(b => b.classList.remove('ativo'));
    btn.classList.add('ativo');
  }

  document.getElementById('solicitante').addEventListener('change', () => {
    const s = document.getElementById('solicitante').value;
    if (s) {
      const senha = prompt(`Digite a senha para ${s}:`);
      if (senha === solicitanteSenhas[s]) {
        senhaAutenticada = true;
        document.getElementById('msg').innerText = "‚úÖ Autenticado!";
      } else {
        senhaAutenticada = false;
        document.getElementById('msg').innerText = "‚ùå Senha incorreta!";
        document.getElementById('solicitante').value = '';
      }
    }
  });

  function enviarItem() {
    const solicitante = document.getElementById('solicitante').value.trim();
    const setor = document.getElementById('setor').value.trim();
    const item = document.getElementById('item').value.trim();
    const quantidade = document.getElementById('quantidade').value.trim();
    const observacoes = document.getElementById('observacoes').value.trim();
    const horaEnvio = new Date().toLocaleTimeString();

    if (!solicitante || !setor || !item || !quantidade || !unidadeSelecionada || !senhaAutenticada) {
      document.getElementById('msg').innerText = "‚ö†Ô∏è Preencha tudo!";
      return;
    }

    document.getElementById('spinner').style.display = 'block';
    document.getElementById('btn-enviar').disabled = true;

    enviados.push({ item, unidade: unidadeSelecionada, quantidade, setor, hora: horaEnvio, status: "Processando" });
    save();
    atualizarTabela();

    const dados = {
      acao: "cadastrar",
      item, unidade: unidadeSelecionada, quantidade, setor, solicitante, observacoes
    };

    fetch(URL_GAS, {
      method: 'POST',
      body: JSON.stringify(dados)
    })
    .then(() => {
      enviados[enviados.length - 1].status = "Enviado";
      save();
      atualizarTabela();
      alert("‚úÖ Item enviado com sucesso!");
      limparCampos();
    })
    .catch(() => {
      document.getElementById('msg').innerText = "‚ùå Erro ao enviar!";
    })
    .finally(() => {
      document.getElementById('spinner').style.display = 'none';
      document.getElementById('btn-enviar').disabled = false;
    });
  }

  function limparCampos() {
    document.getElementById('item').value = '';
    document.getElementById('quantidade').value = '';
    document.getElementById('observacoes').value = '';
    unidadeSelecionada = '';
    document.querySelectorAll('.unidades button').forEach(b => b.classList.remove('ativo'));
  }

  function atualizarTabela() {
    const tabela = document.getElementById('historico');
    tabela.innerHTML = `<tr><th>Produto</th><th>Unidade</th><th>Qtd</th><th>Setor</th><th>Hora</th><th>Status</th></tr>`;
    enviados.forEach(i => {
      const row = tabela.insertRow();
      row.insertCell(0).innerText = i.item;
      row.insertCell(1).innerText = i.unidade;
      row.insertCell(2).innerText = i.quantidade;
      row.insertCell(3).innerText = i.setor;
      row.insertCell(4).innerText = i.hora;
      row.insertCell(5).innerText = i.status;
    });
  }

  function save() {
    localStorage.setItem('enviados', JSON.stringify(enviados));
  }

  function limparTabela() {
    enviados = [];
    save();
    atualizarTabela();
  }

  atualizarTabela();
</script>

</body>
</html>
